<!DOCTYPE html>
<html lang="en">

<head>
    {% include './partials/headtags.html' %}

    <title>EthDecoder</title>
    <style>
        html {
            height: 100vh;
        }

        body {
            font-family: "Hind", sans-serif;
            font-size: 16px;
            background-color: var(--background);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        form {
            display: grid;
            grid-gap: 25px;
            margin-bottom: 16px;
        }

        label {
            font-size: 22px;
            font-weight: 500;
            display: block;
            margin-bottom: 8px;
        }

        input[type="submit"] {
            background-color: var(--background-alt);
            color: #fff;
            border-radius: 3px;
            font-size: 18px;
            padding: 8px 64px;
            cursor: pointer;
            border: none;
            line-height: 1.65;
            margin: 0;
            word-wrap: break-word;
        }

        .container {
            max-width: 840px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .main-title {
            font-size: 38px;
            margin-top: 30px;
            margin-bottom: 30px;
            font-weight: 700;
            line-height: 1;
        }

        .panels {
            display: grid;
            grid-gap: 32px;
            margin-top: 30px;
            margin-bottom: 32px;
        }

        .panel-container {
            background-color: var(--background-muted);
            border-radius: 8px;
            padding: 24px 34px 8px 34px;
            font-size: 20px;
            color: var(--text-alt);
        }

        .panel-container h2 {
            font-size: 22px;
            font-weight: 500;
            margin: 0;
            color: var(--text);
        }

        .input {
            font-size: 18px;
            width: 100%;
            padding: 13px 16px;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid var(--border);
            background-color: transparent;
        }

        .select {
            cursor: pointer;
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            background: url(/static/images/chevron_down.png) no-repeat right 13px center;
        }

        .tx-submit {
            margin-top: 0.625rem;
        }

        .tx-submit input {
            width: 14.375rem;
        }

        .link {
            color: var(--link);
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }

        @media screen and (max-width: 568px) {
            .panel-container {
                padding: 32px 20px;
                font-size: 16px;
            }
        }

        .version {
            font-size: 12px;
            text-align: right;
        }

        .error-msg {
            color: #cc0000;
            font-size: 12px;
            margin-top: 5px;
            position: absolute;
        }

        .tf-img-container {
            display: -webkit-flex;
            display: flex;
            list-style-type: none;
            padding: 0;
            justify-content: flex-end;
            margin: 30px 0 60px;
        }

        .tf-img-container a {
            margin-left: auto;
        }

        .tf-img-container a img {
            float: right;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="main-title">EthTx Transaction Decoder</div>
    <form action="/" method="GET" onsubmit="return onSubmit(this)">
        <div>
            <label for="net">Network</label>
            <select class="input select" id="net">
                <option value="mainnet">ETH mainnet</option>
                <option value="goerli">Goerli testnet</option>
                <option value="rinkeby">Rinkeby testnet</option>
            </select>
        </div>
        <div>
            <label for="tx">Tx Hash</label>
            <input class="input" size="66" type="text" id="tx"
                   oninput="handleValueChange(this.value)"
                   onchange="handleValueChange(this.value)">
            <div class="error-msg" id="error_hash"></div>
        </div>
        <div class="tx-submit">
            <input id="tx_submit" type="submit" value="Decode now" disabled="disabled">
        </div>

    </form>
    <div class="panels">
        <div class="panel-container">
            <h2>About EthTx</h2>
            <p>EthTx is an open source decoder of blockchain transactions that is made freely available to the Ethereum
                Community as a Python library in public PyPi index (<a href="https://pypi.org/project/EthTx/"
                                                                       class="link">project page</a>).</p>
            <p>Everybody is invited to contribute to the codebase (<a href="https://github.com/EthTx/ethtx"
                                                                      class="link">GitHub</a>) via Pull Request or
                Issues and anyone can launch their own instances of EthTx.</p>
            {% if ethtx_version %}
            <p id="ethtx_version" class="version">
                Version:
                <a class="link" href=https://pypi.org/project/EthTx/{{ ethtx_version }}/>{{ ethtx_version }}</a>
            </p>
            {%- endif -%}
        </div>
        <div class="panel-container">
            <h2>About this implementation</h2>
            <p>This instance of EthTx is hosted by Token Flow Insights SA. The team that developed EthTx and the current
                maintainer of the open source repository. For more information about us, please visit <a
                        href="https://tokenflow.live/" class="link">TokenFlow</a>.</p>
            <p>The source code of this Community Edition of EthTx is also free and open source
                (<a href="https://github.com/EthTx/ethtx_ce" class="link">GitHub</a>).</p>
            <p>Use of this implementation is under the <a href="terms" class="link">Terms of Service</a> and <a
                    href="privacy" class="link">Privacy Policy</a></p>
            {% if ethtx_ce_version %}
            <p id="ethtx_ce_version" class="version">
                Version:
                <a class="link" href={{ ethtx_ce_version }}> ethtx_ce</a>
            </p>
            {%- endif -%}
        </div>
    </div>
    <div class="tf-img-container">
        <a href="https://tokenflow.live/">
            <img alt="hosted by Token Flow Insights" width="80%" src="../static/images/hosted-by-color-dark.svg"/>
        </a>
    </div>
    {% include './partials/footer.html' %}
</div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
        function trackDecode() {
            // fathom.trackGoal('PR1BHWAQ')
        }

        document.getElementById("tx_submit").addEventListener("click", trackDecode)
    });

    function onSubmit(e) {
        const tx = document.getElementById(`tx`).value;
        if (checkTxHash(tx) === false) {
            printError("error_hash", "Please, enter a valid transaction hash.")
            return false;
        } else {
            document.getElementById("tx_submit").value = "Decoding..."
            e.action = '/' + e.net.options[e.net.selectedIndex].value + '/' + e.tx.value;
        }
    }

    function handleValueChange(value) {
        document.getElementById("tx_submit").disabled = value.trim() === "";
        hideError("error_hash")
    }

    function checkTxHash(tx) {
        const pattern = new RegExp(/^(0x)?([A-Fa-f0-9]{64})$/)
        return pattern.test(tx);
    }

    function printError(elemId, hintMsg) {
        document.getElementById(elemId).innerHTML = hintMsg;
    }

    function hideError(elemId) {
        const element = document.getElementById(elemId);
        if (element) {
            element.innerHTML = "";
        }
    }

</script>
</body>
</html>