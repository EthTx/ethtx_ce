<!DOCTYPE html>
<html lang="en">

<head>
    {% include './partials/headtags.html' %}

    <title>EthDecoder</title>
    <style>
        html {
            height: 100vh;
        }

        body {
            font-family: "Hind", sans-serif;
            font-size: 16px;
            background-color: var(--background);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        form {
            display: grid;
            grid-gap: 25px;
            margin-bottom: 16px;
        }

        label {
            font-size: 22px;
            font-weight: 500;
            display: block;
            margin-bottom: 8px;
        }

        input[type="submit"] {
            background-color: var(--background-alt);
            color: #fff;
            border-radius: 3px;
            font-size: 18px;
            padding: 8px 64px;
            cursor: pointer;
            border: none;
            line-height: 1.65;
            margin: 0;
            word-wrap: break-word;
        }

        .container {
            max-width: 840px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .main-title {
            font-size: 38px;
            margin-top: 30px;
            margin-bottom: 30px;
            font-weight: 700;
            line-height: 1;
        }

        .panels {
            display: grid;
            margin-top: 30px;
            margin-bottom: 32px;
            grid-gap: 32px;
        }

        .panel-container {
            background-color: var(--background-muted);
            border-radius: 8px;
            padding: 24px 34px 8px 34px;
            font-size: 20px;
            color: var(--text-alt);
        }

        .panel-container h2 {
            font-size: 22px;
            font-weight: 500;
            color: var(--text);
            margin: 0;
        }

        .input {
            font-size: 18px;
            width: 100%;
            padding: 13px 16px;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid var(--border);
            background-color: transparent;
        }

        .select {
            cursor: pointer;
            -moz-appearance: none;
            -webkit-appearance: none;
            appearance: none;
            background: url(/static/images/chevron_down.png) no-repeat right 13px center;
        }

        .tx-submit {
            margin-top: 0.625rem;
        }

        .tx-submit input {
            width: 14.375rem;
        }

        .link {
            color: var(--link);
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }

        @media screen and (max-width: 568px) {
            .panel-container {
                padding: 32px 20px;
                font-size: 16px;
            }
        }

        .version {
            font-size: 12px;
            text-align: right;
        }

        .error-msg {
            color: #cc0000;
            font-size: 12px;
            margin-top: 5px;
            position: absolute;
        }

        .tos-pp {
            font-size: 14px;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="main-title">EthTx Transaction Decoder</div>
    <form action="/" method="GET" onsubmit="return onSubmit(this)">
        <div>
            <label for="net">Network</label>
            <select class="input select" id="net">
                <option value="mainnet">ETH mainnet</option>
                <option value="goerli">Goerli testnet</option>
                <option value="rinkeby">Rinkeby testnet</option>
            </select>
        </div>
        <div>
            <label for="tx">Tx Hash</label>
            <input class="input" size="66" type="text" id="tx"
                   oninput="handleValueChange(this.value)"
                   onchange="handleValueChange(this.value)">
            <div class="error-msg" id="error_hash"></div>
        </div>
        <div class="tx-submit">
            <input id="tx_submit" type="submit" value="Decode now" disabled="disabled">
            <div class="tos-pp">
                <p>Use of this implementation is under the <a href="terms" class="link">Terms of Service</a><br>and <a
                        href="privacy" class="link">Privacy Policy</a></p>
            </div>
        </div>

    </form>
    <div class="panels">
        <div class="panel-container">
            <h2>About EthTx</h2>
            <p>EthTx is an open source tool to decode any transaction that is made freely available to the Ethereum
                Community.</p>
            <p>For any submitted transaction, EthTx will decode it and will provide a detailed execution trace which
                includes emitted events, account balances, token transfers and state diffs.</p>
            <p>The Ethereum community is invited to contribute to the codebase via Pull Request or Issue, and anyone can
                launch their own instances of EthTx. See the GitHub repo for more information <a
                        href="https://github.com/EthTx/ethtx"
                        class="link">here</a>.</p>
            {% if ethtx_version %}
            <p id="ethtx_version" class="version">
                Version:
                <a class="link" href=https://pypi.org/project/EthTx/{{ ethtx_version }}/>{{ ethtx_version }}</a>
            </p>
            {%- endif -%}
        </div>
        <div class="panel-container">
            <h2>About this implementation</h2>
            <p>This instance of EthTx is hosted by Token Flow Insights SA. The team that developed EthTx and the current
                maintainer of the open source repository. For more information about us, please visit <a
                        href="https://tokenflow.live/" class="link">TokenFlow</a>.</p>
            {% if ethtx_ce_version %}
            <p id="ethtx_ce_version" class="version">
                Version:
                <a class="link" href={{ ethtx_ce_version }}> ethtx_ce</a>
            </p>
            {%- endif -%}
        </div>
    </div>
    {% include './partials/footer.html' %}
</div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
        function trackDecode() {
            // fathom.trackGoal('PR1BHWAQ')
        }

        document.getElementById("tx_submit").addEventListener("click", trackDecode)
    });

    function onSubmit(e) {
        const tx = document.getElementById(`tx`).value;
        if (checkTxHash(tx) === false) {
            printError("error_hash", "Please, enter a valid transaction hash.")
            return false;
        } else {
            document.getElementById("tx_submit").value = "Decoding..."
            e.action = '/' + e.net.options[e.net.selectedIndex].value + '/' + e.tx.value;
        }
    }

    function handleValueChange(value) {
        document.getElementById("tx_submit").disabled = value.trim() === "";
        hideError("error_hash")
    }

    function checkTxHash(tx) {
        const pattern = new RegExp(/^(0x)?([A-Fa-f0-9]{64})$/)
        return pattern.test(tx);
    }

    function printError(elemId, hintMsg) {
        document.getElementById(elemId).innerHTML = hintMsg;
    }

    function hideError(elemId) {
        const element = document.getElementById(elemId);
        if (element) {
            element.innerHTML = "";
        }
    }

</script>
</body>
</html>